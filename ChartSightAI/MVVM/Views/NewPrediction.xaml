<?xml version="1.0" encoding="utf-8" ?>
<ContentPage
    x:Class="ChartSightAI.MVVM.Views.NewPrediction"
    xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
    xmlns:Controls="clr-namespace:ChartSightAI.Controls"
    xmlns:models="clr-namespace:ChartSightAI.MVVM.Models"
    xmlns:vm="clr-namespace:ChartSightAI.MVVM.ViewModels"
    x:DataType="vm:NewPredictionVM"
    Background="{StaticResource Brush.BackgroundGradient}"
    Shell.NavBarIsVisible="False">
    <AbsoluteLayout>
        <Grid
            AbsoluteLayout.LayoutBounds="0,0,1,1"
            AbsoluteLayout.LayoutFlags="All"
            RowDefinitions="Auto, *"
            RowSpacing="0">
            <!--  Fixed Header  -->
            <Border
                Grid.Row="0"
                Margin="24,20,24,12"
                Padding="16,12"
                Background="White"
                Shadow="{StaticResource Sh.CardShadow}"
                StrokeShape="RoundRectangle 30"
                StrokeThickness="0">
                <Grid ColumnDefinitions="Auto, *" ColumnSpacing="12">
                    <Image
                        HeightRequest="40"
                        IsAnimationPlaying="True"
                        Source="analyse.gif"
                        VerticalOptions="Center"
                        WidthRequest="40" />
                    <VerticalStackLayout
                        Grid.Column="1"
                        Spacing="2"
                        VerticalOptions="Center">
                        <Label StyleClass="h2" Text="New Analysis Setup" />
                        <Label StyleClass="caption" Text="Enter details and upload your chart to begin." />
                    </VerticalStackLayout>
                </Grid>
            </Border>

            <!--  Main scrollable content area  -->
            <ScrollView
                Grid.Row="1"
                Margin="0,0,0,70"
                Padding="24,0,24,24">
                <StackLayout
                    HorizontalOptions="Center"
                    MaximumWidthRequest="720"
                    Spacing="16">

                    <!--  Market Type  -->
                    <Label
                        Margin="0,0,0,8"
                        StyleClass="h4"
                        Text="Market Type" />
                    <Grid ColumnDefinitions="*, *, *" ColumnSpacing="8">
                        <Button
                            Command="{Binding SelectMarketTypeForexCommand}"
                            StyleClass="na-chip"
                            Text="Forex Market" />
                        <Button
                            Grid.Column="1"
                            Command="{Binding SelectMarketTypeStocksCommand}"
                            StyleClass="na-chip"
                            Text="Stock Market" />
                        <Button
                            Grid.Column="2"
                            Command="{Binding SelectMarketTypeCryptoCommand}"
                            StyleClass="na-chip"
                            Text="Crypto Market" />
                    </Grid>

                    <!--  Chart Timeframe Buttons and Indicator Preset side-by-side  -->
                    <Grid ColumnDefinitions="*, Auto" ColumnSpacing="16">
                        <StackLayout Grid.Column="0" Spacing="8">
                            <Label
                                Margin="0,0,0,8"
                                StyleClass="h4"
                                Text="Chart Timeframe" />
                            <!--  Smaller Grid for Timeframe buttons  -->
                            <Grid
                                ColumnDefinitions="*, *, *"
                                ColumnSpacing="6"
                                RowDefinitions="Auto"
                                RowSpacing="6">
                                <Button
                                    Grid.Column="0"
                                    StyleClass="na-chip"
                                    Text="1H" />
                                <Button
                                    Grid.Column="1"
                                    StyleClass="na-chip"
                                    Text="4H" />
                                <Button
                                    Grid.Column="2"
                                    StyleClass="na-chip, na-chip-selected"
                                    Text="1D" />
                            </Grid>

                            <!--  Main TimeFrame Picker (under the buttons)  -->
                            <Border Margin="0,8,0,0" StyleClass="na-field">
                                <Grid ColumnDefinitions="*, Auto" ColumnSpacing="8">
                                    <Picker
                                        x:Name="TimeFramePicker"
                                        Title="Select Timeframe"
                                        ItemsSource="{Binding TimeFrameOptions}"
                                        SelectedItem="{Binding AnalysisSession.TimeFrame, Mode=TwoWay}"
                                        StyleClass="na-picker"
                                        VerticalOptions="Fill" />
                                    <Label
                                        Grid.Column="1"
                                        Text="▾"
                                        VerticalOptions="Center" />
                                </Grid>
                            </Border>
                        </StackLayout>

                        <StackLayout Grid.Column="1" Spacing="8">
                            <Label
                                Margin="0,0,0,8"
                                StyleClass="h4"
                                Text="Indicator Preset" />
                            <Border StyleClass="na-field">
                                <Grid ColumnDefinitions="*, Auto" ColumnSpacing="8">
                                    <Picker
                                        Title="Recommended"
                                        StyleClass="na-picker"
                                        VerticalOptions="Fill" />
                                    <Label
                                        Grid.Column="1"
                                        Text="▾"
                                        VerticalOptions="Center" />
                                </Grid>
                            </Border>
                        </StackLayout>
                    </Grid>

                    <!--  Strategy Focus  -->
                    <Label
                        Margin="0,16,0,8"
                        StyleClass="h4"
                        Text="Strategy Focus" />
                    <Grid
                        ColumnDefinitions="*, *, *"
                        ColumnSpacing="8"
                        RowSpacing="8">
                        <Button StyleClass="na-badge" Text="Technical" />
                        <Button
                            Grid.Column="1"
                            StyleClass="na-badge"
                            Text="Pattern Recognition" />
                        <Button
                            Grid.Column="2"
                            StyleClass="na-badge"
                            Text="AI Prediction" />
                    </Grid>

                    <!--  Trade Direction  -->
                    <Label
                        Margin="0,16,0,8"
                        StyleClass="h4"
                        Text="Trade Direction" />
                    <Grid ColumnDefinitions="*, *" ColumnSpacing="8">
                        <Button
                            Command="{Binding SelectTradeDirectionLongCommand}"
                            StyleClass="na-cta"
                            Text="Long Trade" />
                        <Button
                            Grid.Column="1"
                            Command="{Binding SelectTradeDirectionShortCommand}"
                            StyleClass="na-cta"
                            Text="Short Trade" />
                    </Grid>
                    <!--  Upload Dropzone  -->
                    <Label
                        Margin="0,16,0,8"
                        StyleClass="h4"
                        Text="Upload Chart" />
                    <Border StyleClass="na-dropzone">
                        <Grid ColumnDefinitions="Auto, *" ColumnSpacing="12">
                            <Border StyleClass="na-pill" VerticalOptions="Center">
                                <Label
                                    HorizontalOptions="Center"
                                    Text="☁"
                                    VerticalOptions="Center" />
                            </Border>
                            <VerticalStackLayout
                                Grid.Column="1"
                                Spacing="2"
                                VerticalOptions="Center">
                                <Label Text="Upload chart image or take a photo" />
                                <Label StyleClass="caption" Text="Tap to upload" />
                            </VerticalStackLayout>
                        </Grid>
                    </Border>

                    <!--  Supports screenshots label under the dropzone  -->
                    <Label StyleClass="caption" Text="Supports screenshots from popular trading platforms (e.g., TradingView, Binance, MT4)." />

                    <!--  Analyze and Cancel buttons side-by-side  -->
                    <Grid
                        Margin="0,24,0,0"
                        ColumnDefinitions="*, *"
                        ColumnSpacing="16">
                        <Button
                            Command="{Binding AnalyzeChartCommand}"
                            StyleClass="na-cta"
                            Text="Analyze Chart" />
                        <Button
                            Grid.Column="1"
                            Command="{Binding CancelCommand}"
                            StyleClass="na-cta"
                            Text="Cancel" />
                    </Grid>
                </StackLayout>
            </ScrollView>
        </Grid>
        <!--  Floating TabBar  -->
        <Controls:TABBAR
            Margin="0,0,0,20"
            AbsoluteLayout.LayoutBounds="0.5,1,1,76"
            AbsoluteLayout.LayoutFlags="PositionProportional,WidthProportional"
            ZIndex="1000" />
    </AbsoluteLayout>
</ContentPage>